<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Job Listings</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
</head>
<body class="bg-gray-100 text-gray-900">

    <!-- Navbar -->
    <nav class="bg-blue-900 text-white px-6 py-4 flex justify-between items-center shadow-md sticky top-0 z-50">
        <a href="#" class="text-xl font-bold">WELCOME to placeX</a>
        
        {% if user_logged_in %}
        <div class="flex items-center gap-4 relative">
            <span>Welcome {{ user.username }}!</span>
            <div class="relative cursor-pointer" onclick="toggleDropdown()">
                <img src="/static/images/thumbnail.webp" alt="Avatar" class="w-10 h-10 rounded-full border-2 border-white">
                <div id="dropdown-menu" class="hidden absolute right-0 mt-2 bg-white rounded shadow-md min-w-[120px] z-50">
                    <a href="#" class="block px-4 py-2 hover:bg-gray-100 text-black">Profile</a>
                    <a href="{% url 'user_logout' %}" class="block px-4 py-2 hover:bg-gray-100 text-black"><i class="fas fa-sign-out-alt mr-2 text-black"></i>Logout</a>
                </div>
            </div>
        </div>
        {% else %}
        <a href="users/" class="bg-yellow-400 hover:bg-yellow-300 text-black font-bold px-4 py-2 rounded">Login</a>
        {% endif %}
    </nav>

    <!-- Filters -->
    <div class="text-center my-6 space-x-4">
        <select id="roleFilter" onchange="filterJobs()" class="px-4 py-2 rounded border border-gray-300">
            <option value="">Filter by Role</option>
        </select>
        <select id="companyFilter" onchange="filterJobs()" class="px-4 py-2 rounded border border-gray-300">
            <option value="">Filter by Company</option>
        </select>
        <select id="locationFilter" onchange="filterJobs()" class="px-4 py-2 rounded border border-gray-300">
            <option value="">Filter by Location</option>
        </select>
    </div>

    <!-- Job Cards -->
    <div id="job-list" class="grid gap-6 px-6 pb-10 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"></div>

    <script>
        const jobs = [
            {% for job in job_list %}
            {
                job_role: "{{ job.job_role|escapejs }}",
                company_name: "{{ job.company_name|escapejs }}",
                location: "{{ job.location|escapejs }}",
                required_skill: "{{ job.required_skill|escapejs }}",
                qualification: "{{ job.qualification|escapejs }}"
            }{% if not forloop.last %},{% endif %}
            {% endfor %}
        ];

        function populateFilters() {
            const roles = new Set(), companies = new Set(), locations = new Set();
            jobs.forEach(job => {
                roles.add(job.job_role);
                companies.add(job.company_name);
                locations.add(job.location);
            });

            function fillDropdown(id, values) {
                const select = document.getElementById(id);
                values.forEach(value => {
                    const option = document.createElement("option");
                    option.value = value;
                    option.textContent = value;
                    select.appendChild(option);
                });
            }

            fillDropdown("roleFilter", roles);
            fillDropdown("companyFilter", companies);
            fillDropdown("locationFilter", locations);
        }

        function renderJobs(filteredJobs = jobs) {
            const jobList = document.getElementById("job-list");
            jobList.innerHTML = filteredJobs.map(job => `
                <div class="bg-white p-6 rounded-lg shadow-lg hover:scale-[1.03] transition-transform">
                    <h2 class="text-xl font-bold mb-2">${job.job_role}</h2>
                    <p><strong>Company:</strong> ${job.company_name}</p>
                    <p><strong>Location:</strong> ${job.location}</p>
                    <p><strong>Required Skills:</strong> ${job.required_skill}</p>
                    <p><strong>Qualification:</strong> ${job.qualification}</p>
                    <button onclick="redirectToSignIn()" class="mt-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded font-semibold">Apply</button>
                </div>
            `).join('');
        }

        function filterJobs() {
            const role = document.getElementById("roleFilter").value;
            const company = document.getElementById("companyFilter").value;
            const location = document.getElementById("locationFilter").value;

            const filteredJobs = jobs.filter(job =>
                (!role || job.job_role === role) &&
                (!company || job.company_name === company) &&
                (!location || job.location === location)
            );

            renderJobs(filteredJobs);
        }

        function redirectToSignIn() {
            window.location.href = "/auth/";
        }

        function toggleDropdown() {
            const dropdown = document.getElementById("dropdown-menu");
            dropdown.classList.toggle("hidden");
        }

        document.addEventListener("click", (e) => {
            const dropdown = document.getElementById("dropdown-menu");
            const avatar = document.querySelector(".relative.cursor-pointer");
            if (dropdown && avatar && !avatar.contains(e.target)) {
                dropdown.classList.add("hidden");
            }
        });

        document.addEventListener("DOMContentLoaded", () => {
            populateFilters();
            renderJobs();
        });
    </script>
</body>
</html>
